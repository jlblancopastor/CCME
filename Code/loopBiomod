#### BIOMOD LOOP FOR EVERY SPECIES IN THE DATASET ####
#### 0. PREPARATORY PROCEDURES ####

packages<-c("raster", "biomod2", "dismo","mgcv","rasterVis","RColorBrewer","rgdal","mgcv","shapefiles","rgeos","sp","maptools", "maps")
lapply(packages, require, character.only=T)
geoproj<-"+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"
species.list("Phyteuma_globulariifolium","Linaria_glacialis") #a list containing the names of the species written exactly as in the qgis folder where all shapefiles are stored

presence.absence.raster <- function (mask.raster,species.data,raster.label="") {
mask.raster[!is.na(mask.raster)] <- 0
speciesRaster <- rasterize(species.data,mask.raster,field=1)
speciesRaster <- merge(speciesRaster,mask.raster)
names(speciesRaster) <- raster.label
return(speciesRaster)
}
#### 1. BIOMOD PARAMETERS ####
#this is set up, for now, in a separate branch
#### 2. LOOP ####

for (i in species.list) {
  setwd("") # where the shapefiles are. Currently for this is in "F:/Climatechange/Qgis"
  shape.species<-readShapePoints(i,proj4string = CRS(geoproj)) #creates a shapefile of points for the ith species
  shape.mountain<-readShapePoly("mountains",proj4string = CRS(geoproj)) #reads the global mountain polygon shapefile
  select.mountain<-over(shape.species,shape.mountain)  #overlays species ocurrences with  
  select.mountain<-as.data.frame(droplevels(select.mountain$Name)) #erase non-used levels
  names.mountain<-levels(select.mountain[,1]) #selects the names of the mountain ranges
  
  #### 2.1 Begin reading shapefiles and preparing stack of predictors
  
    selected.shape.mountain<-shape.mountain[shape.mountain$Name %in% names.mountain,] #subsets the polygons with species occurrences
    unzip("CHELSA_tmax_1_1979-2013_land.zip")
    message(paste("masking tmax01 for",i,sep=" "),appendLF=T)
    tmax01<-mask(crop(raster("CHELSA_tmax_1_1979-2013_land.tif",crs=geoproj),selected.shape.mountain),selected.shape.mountain)
    file.remove("CHELSA_tmax_1_1979-2013_land.tif")
    ### etc.
    
    
  #### 2.2 BIOMOD MODELLING #### MODEL CALIBRATION
  
       2.1
  
}
